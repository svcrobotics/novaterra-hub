<li>
  <% if node[:type] == :folder %>
    <details class="ml-2 group">
      <summary class="cursor-pointer text-[14px] text-gray-800 font-semibold hover:underline transition">
        <span class="text-[14px]">üìÅ</span> <%= node[:name] %>
      </summary>
      <ul class="pl-4 space-y-1">
        <% node[:children].sort_by { |child| child[:name].downcase }.each do |child| %>
          <%= render partial: "file_node", locals: { node: child } %>
        <% end %>
      </ul>
    </details>
  <% else %>
    <% icon = case File.extname(node[:name]).downcase
      when ".rb"       then "üü•"
      when ".erb"      then "üß©"
      when ".html", ".htm", ".html.erb" then "üåê"
      when ".js"       then "üü®"
      when ".ts"       then "üî∑"
      when ".css", ".scss", ".sass" then "üé®"
      when ".yml", ".yaml" then "‚öôÔ∏è"
      when ".json"     then "üßæ"
      when ".md"       then "üìò"
      when ".txt"      then "üìÑ"
      when ".xml"      then "üß∑"
      when ".csv"      then "üìä"
      when ".pdf"      then "üìï"
      when ".png", ".jpg", ".jpeg", ".gif", ".svg", ".webp" then "üñºÔ∏è"
      when ".env"      then "üå±"
      when ".lock"     then "üîí"
      when ".log"      then "üìù"
      when ".sh", ".bash", ".zsh" then "üíª"
      when ".sql"      then "üóÑÔ∏è"
      when ".db"       then "üß¨"
      when ".zip", ".tar", ".gz", ".rar" then "üóúÔ∏è"
      else "üìÑ"
    end %>

    <% is_active = @current_file == node[:path] %>

    <%= link_to ide_path(
          file: node[:path],
          opened_files: @opened_files&.join(','),
          project: @project_root.to_s
        ),
        class: "block text-[14px] px-2 py-1 rounded-md transition pl-6 #{is_active ? 'bg-blue-100 font-semibold text-black' : 'text-black hover:bg-gray-100'}",
        data: { turbo: false },
        title: node[:path] do %>
      <span class="text-[14px]"><%= icon %></span> <%= node[:name] %>
    <% end %>
  <% end %>
</li>
